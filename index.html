<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">¡Nos Casamos! Karen & Fabián</title>

    <!-- Open Graph Meta Tags para Previsualización en Redes Sociales y WhatsApp -->
    <meta property="og:title" content="¡Nos Casamos! Boda de Karen & Fabián">
    <meta property="og:description" content="Nos complace invitarte a celebrar con nosotros este día tan especial. Tu presencia es el mejor regalo.">
    <meta property="og:image" content="https://placehold.co/1200x630/DAA000/ffffff?text=Karen+%26+Fabian+Wedding">
    <meta property="og:url" content="https://9549552895.github.io/mi-boda-karen-fabian/">
    <meta property="og:type" content="website">
    <!-- Twitter Card Tags (opcional, pero recomendado para Twitter) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="¡Nos Casamos! Boda de Karen & Fabián">
    <meta name="twitter:description" content="Nos complace invitarte a celebrar con nosotros este día tan especial. Tu presencia es el mejor regalo.">
    <meta name="twitter:image" content="https://placehold.co/1200x630/DAA000/ffffff?text=Karen+%26+Fabian+Wedding">


    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts para tipografía elegante -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500&family=Great+Vibes&display=swap" rel="stylesheet">
    <!-- Iconos Phosphor -->
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1/dist/phosphor.js"></script>
    <style>
        /* Estilos generales del cuerpo */
        body {
            font-family: 'Inter', sans-serif;
            background: #f7f3ed; /* Fondo claro y cremoso para toda la página */
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Evita el scroll horizontal por animaciones */
        }
        /* Estilos de la tarjeta principal */
        .card-bg {
            background: #ffffff; /* Fondo blanco para la tarjeta principal */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0, 0, 0, 0.05); /* Sombra más pronunciada y elegante */
            border: 1px solid #e0d8cc; /* Borde suave */
            position: relative;
            overflow: hidden; /* Oculta elementos decorativos que se desborden */
            border-radius: 1rem; /* Bordes más redondeados */
            padding: 2.5rem; /* Espaciado interno generoso */
            width: 100%;
            max-width: 44rem; /* Max-width para centrar bien en desktop */
            margin: 1.5rem auto; /* Margen para centrar y espaciar */
        }
        /* Color dorado para textos importantes */
        .golden-text {
            color: #a07a1e;
        }
        /* Fuentes específicas */
        .display-font {
            font-family: 'Playfair Display', serif;
        }
        .great-vibes-font {
            font-family: 'Great Vibes', cursive;
        }
        /* Sombra de texto para los nombres */
        .name-shadow {
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
        }

        /* Tamaños de fuente responsivos */
        @media (max-width: 640px) {
            .text-7xl-custom { font-size: 4.5rem; }
            .text-4xl { font-size: 2.5rem; }
            .text-2xl { font-size: 1.5rem; }
            .text-xl { font-size: 1.25rem; }
            .text-lg { font-size: 1.125rem; }
            .p-8 { padding: 1.5rem; }
            .card-bg { padding: 1.5rem; margin: 1rem auto;}
        }

        /* Mensajes de éxito/error */
        .message-success {
            color: #10B981; /* Tailwind green-500 */
        }
        .message-error {
            color: #EF4444; /* Tailwind red-500 */
        }

        /* Contenedor de mapa responsivo */
        .map-container {
            position: relative;
            padding-bottom: 75%; /* Relación de aspecto 4:3 */
            height: 0;
            overflow: hidden;
            border-radius: 0.5rem;
            border: 1px solid #e0d8cc;
        }
        .map-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        /* Estilos de la galería de fotos */
        .gallery-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e0d8cc;
        }
        .gallery-inner {
            display: flex;
            transition: transform 0.8s ease-in-out;
            width: 100%;
            flex-shrink: 0;
        }
        .gallery-inner img {
            width: 100%;
            flex-shrink: 0;
            height: auto;
            object-fit: cover;
            border-radius: 0.5rem;
            max-height: 250px;
            margin: auto;
            cursor: pointer;
        }
        .gallery-nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            border-radius: 9999px;
            font-size: 1.5rem;
            line-height: 1;
            z-index: 10;
            user-select: none;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .gallery-nav-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
            transform: translateY(-50%) scale(1.1);
        }
        .gallery-prev { left: 0.5rem; }
        .gallery-next { right: 0.5rem; }

        /* Modal de imagen en pantalla completa */
        .image-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .image-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .image-modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 0.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .image-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            z-index: 1001;
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        .image-modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Animaciones al hacer scroll */
        .fade-in-up {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }
        .fade-in-up.animate {
            opacity: 1;
            transform: translateY(0);
        }

        /* Fondo de corazones dorados en la sección de nombres */
        .names-with-hearts-bg {
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMTEuOTk5OSAyMC45NzI1TDEwLjY3ODggMTkuNjg3NkM1LjQ1NzMgMTUuMDA4NSAy萍MTIuMDU0MyAyIDguNTk1OTJDMiA1LjY5MjIzIDQuMzY0IDMuMzI0ODQgNy40NDMzOSAzLjMyNDg0QzkuMTMzMjIgMy4zMjQ0IDguMTkwNDMgNS40MjUyNEMxMi4xMjU2IDUuNjk1ODcgMTIuNDI3MyA1LjU2OTE3IDEyLjU1NjMgNS42NzI1N0MxMy4yMjE2IDUuNjcwOTEgMTQuODg2NiAzLjMyNDg0IDE2LjU1NiAzLjMyNDg0QzE5LjYzNTUgMy4zMjQ4NCAyMiA1LjY5NjE1IDIyIDguNTk1OTJDMjIgMTIuMDU0MyAxOC41NDI3IDE1LjAwODUgMTMuMzIyMiAxOS42ODc2TDEwLjkwOTkgMjAuOTcyNVoiIGZpbGw9IiNEQUEwMDAiIG9wYWNpdHk9IjAuMDgiLz4KPC9zdmc+');
            background-repeat: repeat;
            background-size: 38px 38px;
            background-position: center;
            border-radius: 1rem;
            padding: 1rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }

        /* Selector de idioma principal */
        .language-selector-main {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }
        .lang-button-main {
            background-color: rgba(255, 255, 255, 0.8);
            color: #555;
            padding: 0.3rem 0.7rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
            border: 1px solid #e0d8cc;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .lang-button-main.active, .lang-button-main:hover {
            background-color: #a07a1e;
            color: white;
            border-color: #a07a1e;
            transform: translateY(-2px);
        }
        @media (max-width: 640px) {
            .language-selector-main {
                top: 0.75rem;
                right: 0.75rem;
                gap: 0.3rem;
            }
            .lang-button-main {
                padding: 0.2rem 0.5rem;
                font-size: 0.7rem;
            }
        }

        /* Estilos para el Libro de Recuerdos (Nuevo Diseño) */
        #guestbookFormContainer {
            background-color: #fffbeb; /* Un amarillo crema muy suave */
            border: 1px solid #fbd38d; /* Borde dorado sutil */
            border-radius: 0.75rem; /* Bordes suaves */
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); /* Sombra más pronunciada pero suave */
            margin-top: 1.5rem;
            position: relative; /* Para posibles elementos decorativos */
        }

        #guestbookFormContainer .form-label {
            color: #555;
            font-weight: 500;
        }
        #guestbookFormContainer input,
        #guestbookFormContainer textarea {
            border-color: #d4c8bc !important; /* Bordes claros para los inputs */
            background-color: #ffffff !important;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        #guestbookFormContainer input:focus,
        #guestbookFormContainer textarea:focus {
            border-color: #a07a1e !important; /* Resaltado dorado al enfocar */
            box-shadow: 0 0 0 2px rgba(160, 122, 30, 0.2) !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 lang-es">
    <div class="card-bg">
        <!-- Selector de idioma -->
        <div class="language-selector-main">
            <button id="langEsMain" class="lang-button-main active" data-lang="es">ES</button>
            <button id="langEnMain" class="lang-button-main" data-lang="en">EN</button>
        </div>

        <!-- "SAVE THE DATE" equivalente -->
        <p id="saveTheDateText" class="text-xl display-font tracking-widest uppercase text-gray-700 fade-in-up">NOS CASAMOS</p>

        <!-- Nombres con Fondo de Corazones -->
        <div class="names-with-hearts-bg">
            <h1 class="text-7xl-custom md:text-8xl great-vibes-font golden-text leading-tight name-shadow fade-in-up">Karen</h1>
            <p class="text-4xl great-vibes-font golden-text fade-in-up">&amp;</p>
            <h2 class="text-7xl-custom md:text-8xl great-vibes-font golden-text leading-tight name-shadow fade-in-up">Fabián</h2>
        </div>

        <!-- Frase bonita -->
        <p id="quoteText" class="text-lg italic text-gray-600 display-font mt-4 fade-in-up">
            "El amor es la fuerza más sutil del mundo."
        </p>

        <!-- Texto de invitación -->
        <p id="invitationText" class="text-base md:text-lg text-gray-700 leading-relaxed mt-4 fade-in-up">
            Nos complace invitarte a celebrar con nosotros este día tan especial.
            Tu presencia es el mejor regalo.
        </p>

        <!-- Fecha y Hora -->
        <div class="space-y-2 mt-6 fade-in-up">
            <p id="dateText" class="text-2xl md:text-3xl display-font uppercase text-gray-800">20 DE SEPTIEMBRE 2025</p>
            <p id="timeText" class="text-xl md:text-2xl display-font text-gray-700">8:00 P.M.</p>
            <p id="locationText" class="text-lg md:text-xl display-font text-gray-600">5500 N LAKEWOOD CIR, MARGATE FL 33063</p>
        </div>

        <!-- Cuenta Regresiva -->
        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="countdownTitle" class="text-2xl display-font golden-text mb-4">¡Falta Poco!</h3>
            <div id="countdown" class="text-center">
                <span class="countdown-item"><span id="days">00</span><span id="daysLabel">Días</span></span>
                <span class="countdown-item"><span id="hours">00</span><span id="hoursLabel">Horas</span></span>
                <span class="countdown-item"><span id="minutes">00</span><span id="minutesLabel">Minutos</span></span>
                <span class="countdown-item"><span id="seconds">00</span><span id="secondsLabel">Segundos</span></span>
            </div>
            <p id="countdownSubtitle" class="text-sm italic text-gray-500 mt-2">(Hasta el 20 de Septiembre de 2025 a las 8:00 P.M.)</p>
        </div>

        <!-- Nuestra Historia -->
        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="ourStoryTitle" class="text-2xl display-font golden-text mb-4">Nuestra Historia</h3>
            <p id="ourStoryText" class="text-gray-700 text-base md:text-lg leading-relaxed">
                Cada historia de amor es única, y la nuestra comenzó en un inesperado encuentro,
                donde dos caminos se cruzaron para crear un universo propio. Desde ese día,
                cada momento ha sido una aventura, un aprendizaje y un crecimiento mutuo.
                Hoy, con el corazón lleno de gratitud y alegría, nos preparamos para escribir
                nuestro siguiente capítulo, ¡el más emocionante de todos!
            </p>
            <!-- Puedes añadir un video aquí si lo deseas. Ejemplo: -->
            <!-- <div class="mt-6 aspect-video w-full rounded-lg overflow-hidden shadow-lg">
                <iframe src="https://www.youtube.com/embed/TU_ID_DE_VIDEO" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full"></iframe>
            </div>
            <p class="text-sm italic text-gray-500 mt-2">
                (Reemplaza TU_ID_DE_VIDEO con el ID de tu video de YouTube)
            </p> -->
        </div>

        <!-- Galería de Fotos Mejorada -->
        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="galleryTitle" class="text-2xl display-font golden-text mb-4">Nuestros Momentos</h3>
            <div class="gallery-container">
                <div id="galleryInner" class="gallery-inner">
                    <!-- Las siguientes rutas han sido actualizadas con tus nombres de archivo y alt text descriptivos. -->
                    <img src="fotos/IMG_0759.jpg" data-src-large="fotos/IMG_0759.jpg" alt="Karen y Fabián con fuegos artificiales" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+1';">
                    <img src="fotos/IMG_1680.jpg" data-src-large="fotos/IMG_1680.jpg" alt="Karen y Fabián con amigos en una librería/bar" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+2';">
                    <img src="fotos/IMG_1766.jpg" data-src-large="fotos/IMG_1766.jpg" alt="Grupo de amigos cenando en un restaurante" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+3';">
                    <img src="fotos/IMG_1899.jpg" data-src-large="fotos/IMG_1899.jpg" alt="Karen y Fabián sonriendo en una cena al aire libre con amigos" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+4';">
                    <img src="fotos/IMG_1904.jpg" data-src-large="fotos/IMG_1904.jpg" alt="Karen y Fabián en una reunión casual con amigos" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+5';">
                    <img src="fotos/IMG_5550.jpg" data-src-large="fotos/IMG_5550.jpg" alt="Fabián abrazando a Karen en un restaurante" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+6';">
                    <img src="fotos/IMG_5556.jpg" data-src-large="fotos/IMG_5556.jpg" alt="Karen, Fabián y un familiar en la mesa de un restaurante" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+7';">
                    <img src="fotos/IMG_5558.jpg" data-src-large="fotos/IMG_5558.jpg" alt="Fabián usando un babero de restaurante con el logo 'La Pata Gorda'" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+8';">
                    <img src="fotos/IMG_5567.jpg" data-src-large="fotos/IMG_5567.jpg" alt="Karen y Fabián posando frente a la cocina de 'La Pata Gorda'" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+9';">
                    <img src="fotos/IMG_0180.jpg" data-src-large="fotos/IMG_0180.jpg" alt="Karen y Fabián sonriendo, Karen sostiene una bolsa de regalo" onerror="this.onerror=null;this.src='https://placehold.co/250x250/cccccc/666666?text=Foto+10';">
                    <!-- Si tienes más fotos, añádelas aquí siguiendo el mismo formato -->
                </div>
                <button id="galleryPrev" class="gallery-nav-button" aria-label="Anterior">&#10094;</button>
                <button id="galleryNext" class="gallery-nav-button" aria-label="Siguiente">&#10095;</button>
                <div class="flex justify-center mt-4">
                    <button id="slideshowToggle" class=" !text-base !font-medium !text-gray-600 !px-4 !py-2 !rounded-full !bg-gray-100 hover:!bg-gray-200" aria-label="Alternar reproducción automática de galería">
                        <i class="ph ph-pause" id="slideshowIcon"></i> <span id="autoGalleryText">Auto</span>
                    </button>
                </div>
            </div>
            <p id="gallerySubtitle" class="text-sm italic text-gray-500 mt-2">Desliza para ver más de nuestra historia, o usa el modo automático.</p>
        </div>

        <!-- Modal para Imagen en Pantalla Completa -->
        <div id="imageModal" class="image-modal-overlay">
            <button id="imageModalClose" class="image-modal-close" aria-label="Cerrar imagen"><i class="ph ph-x-circle"></i></button>
            <img id="modalImage" class="image-modal-content" src="" alt="Imagen ampliada">
        </div>


        <!-- Agenda / Cronograma -->
        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="agendaTitle" class="text-2xl display-font golden-text mb-4">Agenda del Día</h3>
            <div class="text-gray-700 text-base md:text-lg space-y-2">
                <!-- Se ha modificado para que este texto sea un enlace que añade al calendario -->
                <a href="#" id="addToCalendarBtn" class="block text-gray-700 hover:text-blue-600 hover:underline transition-colors duration-200">
                    <strong id="agendaTime">8:00 P.M.</strong> <span id="agendaEvent">Inicio de la Celebración / Recepción</span>
                    <span id="addToCalendarPrompt" class="block text-sm italic text-gray-500 mt-1">Toca para añadir al calendario</span>
                </a>
            </div>
        </div>

        <!-- Lugar y Mapa -->
        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="locationTitle" class="text-2xl display-font golden-text mb-4">Lugar</h3>
            <p id="addressText" class="text-gray-700 text-base md:text-lg mb-4">
                5500 N LAKEWOOD CIR, MARGATE FL 33063
            </p>
            <div class="map-container mb-4">
                <!-- Usando el parámetro 'q' con la dirección completa para mayor precisión -->
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3588.660161405101!2d-80.20849202386803!3d25.96105340156943!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x88d9047915233c4f%3A0x2a912e9641c2d921!2s5500%20N%20Lakewood%20Cir%2C%20Margate%2C%20FL%2033063%2C%20USA!5e0!3m2!1sen!2sus!4v1719000000000!5m2!1sen!2sus"
                    allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>
            <!-- Enlace directo a Google Maps con la dirección exacta -->
            <a id="mapLink" href="https://maps.app.goo.gl/?q=5500+N+Lakewood+Cir,+Margate,+FL+33063" target="_blank" rel="noopener noreferrer"
               class="text-blue-600 hover:underline text-sm md:text-base transition-colors duration-200">
                <span id="viewMapText">Ver en Google Maps</span>
            </a>
        </div>

        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="giftsTitle" class="text-2xl display-font golden-text mb-4">Regalos</h3>
            <p id="giftsText1" class="text-gray-700 text-base md:text-lg">
                ¡Tu presencia es nuestro mejor regalo!
                Si gustas contribuir para la luna de miel, puedes enviar un Zelle a 9549552895.
            </p>
            <a id="giftsLink" href="#" onclick="return false;"
               class="inline-block bg-gradient-to-r from-yellow-300 to-yellow-500 text-yellow-900 font-semibold py-2 px-6 rounded-full shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-300 mt-4">
               <i class="ph ph-gift-bold mr-2"></i> <span id="contributeText">Enviar Zelle</span>
            </a>
            <p id="giftsNoteText" class="text-sm italic text-gray-500 mt-2">
                (Toca el botón para copiar el número de Zelle.)
            </p>
        </div>

        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="contactTitle" class="text-2xl display-font golden-text mb-4">Contacto para Dudas</h3>
            <p id="karenContactText" class="text-gray-700 text-base md:text-lg">
                <a href="#" id="karenContact" class="text-blue-600 hover:underline transition-colors duration-200">Karen: 786-285-5066 <span class="text-sm text-gray-500 ml-2">(Toca aquí para WhatsApp)</span></a>
            </p>
            <p id="fabianContactText" class="text-gray-700 text-base md:text-lg">
                <a href="#" id="fabianContact" class="text-blue-600 hover:underline transition-colors duration-200">Fabián: 954-955-2895 <span class="text-sm text-gray-500 ml-2">(Toca aquí para WhatsApp)</span></a>
            </p>
        </div>

        <!-- Sugiere una Canción -->
        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="songSuggestionTitle" class="text-2xl display-font golden-text mb-4">¡Sugiere una Canción para la Fiesta!</h3>
            <form id="songRequestForm" class="space-y-4">
                <div>
                    <label for="songName" id="songNameLabel" class="block text-gray-700 text-sm font-bold mb-2">
                        Título de la Canción:
                    </label>
                    <input type="text" id="songName" name="songName" required
                           class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                </div>
                <div>
                    <label for="songArtist" id="songArtistLabel" class="block text-gray-700 text-sm font-bold mb-2">
                        Artista/Banda (Opcional):
                    </label>
                    <input type="text" id="songArtist" name="songArtist"
                           class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                </div>
                <div>
                    <label for="songExplanation" id="songExplanationLabel" class="block text-gray-700 text-sm font-bold mb-2">
                        Explicación/Mensaje para el DJ (Opcional):
                    </label>
                    <textarea id="songExplanation" name="songExplanation" rows="2"
                              class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent resize-y transition-all duration-200"></textarea>
                </div>
                <div>
                    <label for="requesterNameSong" id="requesterNameSongLabel" class="block text-gray-700 text-sm font-bold mb-2">
                        Tu Nombre (Opcional):
                    </label>
                    <input type="text" id="requesterNameSong" name="requesterNameSong"
                           class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                </div>
                <button type="submit" id="submitSongBtn"
                        class="bg-gradient-to-r from-blue-500 to-blue-700 text-white font-semibold py-2 px-6 rounded-full shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-300">
                    <i class="ph ph-paper-plane-tilt-fill mr-2"></i> <span id="sendSuggestionText">Enviar Sugerencia</span>
                </button>
            </form>
            <div id="songMessage" class="hidden mt-4 text-center text-base font-semibold"></div>
        </div>

        <!-- Libro de Firmas Virtual -->
        <div class="mt-8 pt-4 border-t border-gray-200 fade-in-up">
            <h3 id="guestbookTitle" class="text-2xl display-font golden-text mb-4">Deja un mensaje en el Libro de los recuerdos</h3>
            <div id="guestbookFormContainer"> <!-- Contenedor para el estilo de libro -->
                <form id="guestbookForm" class="space-y-4">
                    <div>
                        <label for="guestbookMessage" id="guestbookMessageLabel" class="block text-gray-700 text-sm font-bold mb-2 form-label">
                            Tu Mensaje:
                        </label>
                        <textarea id="guestbookMessage" name="guestbookMessage" rows="4" required
                                  class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent resize-y transition-all duration-200"></textarea>
                    </div>
                    <div>
                        <label for="guestbookSigner" id="guestbookSignerLabel" class="block text-gray-700 text-sm font-bold mb-2 form-label">
                            Tu Nombre:
                        </label>
                        <input type="text" id="guestbookSigner" name="guestbookSigner" required
                               class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                    </div>
                    <button type="submit" id="signGuestbookBtn"
                            class="bg-gradient-to-r from-purple-500 to-purple-700 text-white font-semibold py-2 px-6 rounded-full shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-300">
                        <i class="ph ph-pencil-simple-line-fill mr-2"></i> <span id="signGuestbookText">Firmar Libro</span>
                    </button>
                </form>
            </div>
            <div id="guestbookMessageDiv" class="hidden mt-4 text-center text-base font-semibold"></div>
        </div>

        <!-- Sección RSVP -->
        <div id="rsvpSection" class="mt-8 pt-4 border-t border-gray-200 fade-in-up flex flex-col items-center">
            <p id="rsvpDeadlineText" class="golden-text font-bold text-lg md:text-xl tracking-wide mb-4 text-center">
                Fecha límite para tu confirmación: 13/07/2025
            </p>
            <button id="showRsvpFormButton"
                    class="inline-block bg-gradient-to-r from-yellow-600 to-yellow-800 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-300 display-font tracking-wide">
                <i class="ph ph-check-circle-fill mr-2"></i> <span id="confirmAttendanceText">Confirmar Asistencia</span>
            </button>
            <div id="rsvpFormContainer" class="hidden mt-6 text-left w-full">
                <form id="rsvpForm" class="space-y-4">
                    <div>
                        <label for="guestName" id="rsvpGuestNameLabel" class="block text-gray-700 text-sm font-bold mb-2">
                            Tu Nombre Completo:
                        </label>
                        <input type="text" id="guestName" name="guestName" required
                               class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                    </div>
                    <div>
                        <label for="numAdults" id="numAdultsLabel" class="block text-gray-700 text-sm font-bold mb-2">
                            ¿Cuántos adultos asistirán?
                        </label>
                        <input type="number" id="numAdults" name="numAdults" min="0" value="1" required
                               class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                    </div>
                    <div>
                        <label for="numMinors" id="numMinorsLabel" class="block text-gray-700 text-sm font-bold mb-2">
                            ¿Cuántos menores (niños) asistirán?
                        </label>
                        <input type="number" id="numMinors" name="numMinors" min="0" value="0" required
                               class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200">
                    </div>
                    <div class="flex justify-between items-center pt-4">
                        <button type="submit" id="sendRsvpBtn"
                                class="bg-gradient-to-r from-green-500 to-green-700 text-white font-semibold py-2 px-6 rounded-full shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-300">
                            <i class="ph ph-paper-plane-right-fill mr-2"></i> <span id="sendConfirmationText">Enviar Confirmación</span>
                        </button>
                        <button type="button" id="declineButton"
                                class="bg-gray-400 text-white font-semibold py-2 px-6 rounded-full shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-300">
                            <i class="ph ph-x-circle-fill mr-2"></i> <span id="declineText">No asistiré</span>
                        </button>
                    </div>
                </form>
            </div>
            <div id="rsvpMessage" class="hidden mt-6 text-center text-lg font-semibold text-gray-800">
                <!-- El mensaje de confirmación se mostrará aquí -->
            </div>
        </div>

    </div>

    <!-- SDKs de Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // TU CONFIGURACIÓN DE FIREBASE (PROYECTO: MiAppboda)
        const firebaseConfig = {
            apiKey: "AIzaSyDpAxNRADMfHkSlxBpJIe9WaB3_rWz1Vd4",
            authDomain: "miappboda.firebaseapp.com",
            projectId: "miappboda",
            storageBucket: "miappboda.firebasestorage.app",
            messagingSenderId: "155595716187",
            appId: "1:155595716187:web:11ba23c2bde759bcf0717e",
            measurementId: "G-CL89DVBBHP"
        };

        // Obtenemos el appId de la configuración de Firebase
        const appId = firebaseConfig.appId;

        let app, db, auth, userId;
        let isAuthReady = false;

        // --- Translation Data ---
        const translations = {
            es: {
                pageTitle: "¡Nos Casamos! Karen & Fabián",
                saveTheDateText: "NOS CASAMOS",
                quoteText: "El amor es la fuerza más sutil del mundo.",
                invitationText: "Nos complace invitarte a celebrar con nosotros este día tan especial. Tu presencia es el mejor regalo.",
                dateText: "20 DE SEPTIEMBRE 2025",
                timeText: "8:00 P.M.",
                locationText: "5500 N LAKEWOOD CIR, MARGATE FL 33063", // Updated address
                countdownTitle: "¡Falta Poco!",
                daysLabel: "Días",
                hoursLabel: "Horas",
                minutesLabel: "Minutos",
                secondsLabel: "Segundos",
                countdownSubtitle: "(Hasta el 20 de Septiembre de 2025 a las 8:00 P.M.)",
                ourStoryTitle: "Nuestra Historia",
                ourStoryText: "Cada historia de amor es única, y la nuestra comenzó en un inesperado encuentro, donde dos caminos se cruzaron para crear un universo propio. Desde ese día, cada momento ha sido una aventura, un aprendizaje y un crecimiento mutuo. Hoy, con el corazón lleno de gratitud y alegría, nos preparamos para escribir nuestro siguiente capítulo, ¡el más emocionante de todos!",
                galleryTitle: "Nuestros Momentos",
                gallerySubtitle: "Desliza para ver más de nuestra historia, o usa el modo automático.",
                autoGalleryText: "Auto",
                agendaTitle: "Agenda del Día",
                agendaTime: "8:00 P.M.", // Time value (static)
                agendaEvent: "Inicio de la Celebración / Recepción",
                addToCalendarPrompt: "Toca para añadir al calendario",
                locationTitle: "Lugar",
                addressText: "5500 N LAKEWOOD CIR, MARGATE FL 33063", // Updated address
                viewMapText: "Ver en Google Maps",
                giftsTitle: "Regalos",
                giftsText1: "¡Tu presencia es nuestro mejor regalo! Si gustas contribuir para la luna de miel, puedes enviar un Zelle a 9549552895.",
                contributeText: "Enviar Zelle",
                giftsNoteText: "(Toca el botón para copiar el número de Zelle.)",
                contactTitle: "Contacto para Dudas",
                songSuggestionTitle: "¡Sugiere una Canción para la Fiesta!",
                songNameLabel: "Título de la Canción:",
                songArtistLabel: "Artista/Banda (Opcional):",
                songExplanationLabel: "Explicación/Mensaje para el DJ (Opcional):",
                requesterNameSongLabel: "Tu Nombre (Opcional):",
                sendSuggestionText: "Enviar Sugerencia",
                guestbookTitle: "Deja un mensaje en el Libro de los recuerdos",
                guestbookMessageLabel: "Tu Mensaje:",
                guestbookSignerLabel: "Tu Nombre:",
                signGuestbookText: "Firmar Libro",
                confirmAttendanceText: "Confirmar Asistencia",
                rsvpDeadlineText: "Fecha límite para tu confirmación: 13/07/2025",
                rsvpGuestNameLabel: "Tu Nombre Completo:",
                numAdultsLabel: "¿Cuántos adultos asistirán?",
                numMinorsLabel: "¿Cuántos menores (niños) asistirán?",
                sendConfirmationText: "Enviar Confirmación",
                declineText: "No asistiré",
                rsvpSuccess: (name, adults, minors) => `¡Gracias, ${name}! Tu asistencia de ${adults} adulto(s) y ${minors} menor(es) ha sido confirmada.`,
                rsvpDeclined: (name) => `¡Gracias, ${name}! Lamentamos que no puedas asistir.`,
                songSuccess: (song, artist) => `¡Gracias por tu sugerencia, ${song} por ${artist || 'Artista Desconocido'} ha sido añadida!`,
                guestbookSuccess: (signer) => `¡Gracias, ${signer}! Tu mensaje ha sido guardado.`,
                formErrorGeneric: "Por favor, espera un momento mientras cargamos la aplicación o hubo un error de inicialización.",
                formErrorName: "Por favor, introduce tu nombre.",
                formErrorAdults: "Por favor, introduce un número válido de adultos (0 o más).",
                formErrorMinors: "Por favor, introduce un número válido de menores (0 o más).",
                formErrorZeroGuests: "Has indicado 0 adultos y 0 menores. Si no puedes asistir, usa el botón 'No asistiré'. Si es un error, por favor, ajusta los números.",
                formErrorSongTitle: "Por favor, introduce el título de la canción.",
                formErrorMessage: "Por favor, escribe tu mensaje.",
                formErrorSigner: "Por favor, introduce tu nombre para firmar.",
                errorSubmitting: "Error al enviar tu confirmación. Por favor, inténtalo de nuevo.",
                errorSubmittingDecline: "Error al registrar tu no asistencia. Por favor, inténtalo de nuevo.",
                errorSubmittingSong: "Error al enviar tu sugerencia de canción. Por favor, inténtalo de nuevo.",
                errorSubmittingGuestbook: "Error al enviar tu mensaje. Por favor, inténtalo de nuevo.",
                karenWhatsappMessage: "Hola Karen, tengo una pregunta sobre la boda.",
                fabianWhatsappMessage: "Hola Fabián, tengo una pregunta sobre la boda.",
                zelleCopied: "Número de Zelle copiado: 9549552895",
                copyError: "Error al copiar el número de Zelle."
            },
            en: {
                pageTitle: "We're Getting Married! Karen & Fabián",
                saveTheDateText: "WE'RE GETTING MARRIED",
                quoteText: "Love is the subtlest force in the world.",
                invitationText: "We are delighted to invite you to celebrate with us this very special day. Your presence is the greatest gift.",
                dateText: "SEPTEMBER 20, 2025",
                timeText: "8:00 P.M.",
                locationText: "5500 N LAKEWOOD CIR, MARGATE FL 33063", // Updated address
                countdownTitle: "Almost There!",
                daysLabel: "Days",
                hoursLabel: "Hours",
                minutesLabel: "Minutes",
                secondsLabel: "Seconds",
                countdownSubtitle: "(Until September 20, 2025 at 8:00 P.M.)",
                ourStoryTitle: "Our Story",
                ourStoryText: "Every love story is unique, and and ours began in an unexpected encounter, where two paths crossed to create a universe of our own. Since that day, every moment has been an adventure, a learning experience, and mutual growth. Today, with hearts full of gratitude and joy, we prepare to write our next chapter, the most exciting one yet!",
                galleryTitle: "Our Moments",
                gallerySubtitle: "Swipe to see more of our story, or use auto-play mode.",
                autoGalleryText: "Auto",
                agendaTitle: "Day's Agenda",
                agendaTime: "8:00 P.M.",
                agendaEvent: "Celebration / Reception Starts",
                addToCalendarPrompt: "Tap to add to calendar",
                locationTitle: "Location",
                addressText: "5500 N LAKEWOOD CIR, MARGATE FL 33063", // Updated address
                viewMapText: "View on Google Maps",
                giftsTitle: "Gifts",
                giftsText1: "Your presence is our greatest gift! If you wish to contribute to the honeymoon, you can send a Zelle to 9549552895.",
                contributeText: "Send Zelle",
                giftsNoteText: "(Tap the button to copy the Zelle number.)",
                contactTitle: "Contact for Questions",
                songSuggestionTitle: "Suggest a Song for the Party!",
                songNameLabel: "Song Title:",
                songArtistLabel: "Artist/Band (Optional):",
                songExplanationLabel: "Explanation/Message for DJ (Optional):",
                requesterNameSongLabel: "Your Name (Optional):",
                sendSuggestionText: "Send Suggestion",
                guestbookTitle: "Leave a message in the Memory Book",
                guestbookMessageLabel: "Your Message:",
                guestbookSignerLabel: "Your Name:",
                signGuestbookText: "Sign Guestbook",
                confirmAttendanceText: "Confirm Attendance",
                rsvpDeadlineText: "RSVP deadline: 07/13/2025",
                rsvpGuestNameLabel: "Your Full Name:",
                numAdultsLabel: "How many adults will attend?",
                numMinorsLabel: "How many minors (children) will attend?",
                sendConfirmationText: "Send Confirmation",
                declineText: "Cannot attend",
                rsvpSuccess: (name, adults, minors) => `Thank you, ${name}! Your attendance for ${adults} adult(s) and ${minors} minor(s) has been confirmed.`,
                rsvpDeclined: (name) => `Thank you, ${name}! We're sorry you can't make it.`,
                songSuccess: (song, artist) => `Thank you for your suggestion, ${song} by ${artist || 'Unknown Artist'} has been added!`,
                guestbookSuccess: (signer) => `Thank you, ${signer}! Your message has been saved.`,
                formErrorGeneric: "Please wait a moment while the application loads or there was an initialization error.",
                formErrorName: "Please enter your name.",
                formErrorAdults: "Please enter a valid number of adults (0 or more).",
                formErrorMinors: "Please enter a valid number of minors (0 or more).",
                formErrorZeroGuests: "You indicated 0 adults and 0 minors. If you cannot attend, please use the 'Cannot attend' button. If this is an error, please adjust the numbers.",
                formErrorSongTitle: "Please enter the song title.",
                formErrorMessage: "Please write your message.",
                formErrorSigner: "Please enter your name to sign.",
                errorSubmitting: "Error submitting your confirmation. Please try again.",
                errorSubmittingDecline: "Error registering your declination. Please try again.",
                errorSubmittingSong: "Error submitting your song suggestion. Please try again.",
                errorSubmittingGuestbook: "Error submitting your message. Please try again.",
                karenWhatsappMessage: "Hi Karen, I have a question about the wedding.",
                fabianWhatsappMessage: "Hi Fabián, I have a question about the wedding.",
                zelleCopied: "Zelle number copied: 9549552895",
                copyError: "Error copying Zelle number."
            }
        };

        let currentLang = localStorage.getItem('weddingLang') || 'es'; // Default to Spanish for main invitation


        // Function to apply translations
        function applyTranslations(lang) {
            // Update all translatable text content
            document.getElementById('pageTitle').textContent = translations[lang].pageTitle;
            document.getElementById('saveTheDateText').textContent = translations[lang].saveTheDateText;
            document.getElementById('quoteText').textContent = translations[lang].quoteText;
            document.getElementById('invitationText').textContent = translations[lang].invitationText;
            document.getElementById('dateText').textContent = translations[lang].dateText;
            document.getElementById('timeText').textContent = translations[lang].timeText;
            document.getElementById('locationText').textContent = translations[lang].locationText;
            document.getElementById('countdownTitle').textContent = translations[lang].countdownTitle;
            document.getElementById('daysLabel').textContent = translations[lang].daysLabel;
            document.getElementById('hoursLabel').textContent = translations[lang].hoursLabel;
            document.getElementById('minutesLabel').textContent = translations[lang].minutesLabel;
            document.getElementById('secondsLabel').textContent = translations[lang].secondsLabel;
            document.getElementById('countdownSubtitle').textContent = translations[lang].countdownSubtitle;
            document.getElementById('ourStoryTitle').textContent = translations[lang].ourStoryTitle;
            document.getElementById('ourStoryText').textContent = translations[lang].ourStoryText;
            document.getElementById('galleryTitle').textContent = translations[lang].galleryTitle;
            document.getElementById('gallerySubtitle').textContent = translations[lang].gallerySubtitle;
            document.getElementById('autoGalleryText').textContent = translations[lang].autoGalleryText;
            document.getElementById('agendaTitle').textContent = translations[lang].agendaTitle;
            document.getElementById('agendaTime').textContent = translations[lang].agendaTime; // Time value (static)
            document.getElementById('agendaEvent').textContent = translations[lang].agendaEvent;
            document.getElementById('addToCalendarPrompt').textContent = translations[lang].addToCalendarPrompt;
            document.getElementById('locationTitle').textContent = translations[lang].locationTitle;
            document.getElementById('addressText').textContent = translations[lang].addressText;
            document.getElementById('viewMapText').textContent = translations[lang].viewMapText;
            document.getElementById('giftsTitle').textContent = translations[lang].giftsTitle;
            document.getElementById('giftsText1').textContent = translations[lang].giftsText1;
            document.getElementById('contributeText').textContent = translations[lang].contributeText;
            document.getElementById('giftsNoteText').textContent = translations[lang].giftsNoteText;
            document.getElementById('contactTitle').textContent = translations[lang].contactTitle;

            // Update contact links' inner spans for the WhatsApp legend
            document.getElementById('karenContact').innerHTML = `Karen: 786-285-5066 <span class="text-sm text-gray-500 ml-2">(${translations[lang].addToCalendarPrompt.includes('Toca') ? 'Toca aquí para WhatsApp' : 'Tap here for WhatsApp'})</span>`;
            document.getElementById('fabianContact').innerHTML = `Fabián: 954-955-2895 <span class="text-sm text-gray-500 ml-2">(${translations[lang].addToCalendarPrompt.includes('Toca') ? 'Toca aquí para WhatsApp' : 'Tap here for WhatsApp'})</span>`;


            document.getElementById('songSuggestionTitle').textContent = translations[lang].songSuggestionTitle;
            document.getElementById('songNameLabel').textContent = translations[lang].songNameLabel;
            document.getElementById('songArtistLabel').textContent = translations[lang].songArtistLabel;
            document.getElementById('songExplanationLabel').textContent = translations[lang].songExplanationLabel;
            document.getElementById('requesterNameSongLabel').textContent = translations[lang].requesterNameSongLabel;
            document.getElementById('submitSongBtn').querySelector('span').textContent = translations[lang].sendSuggestionText;
            document.getElementById('guestbookTitle').textContent = translations[lang].guestbookTitle;
            document.getElementById('guestbookMessageLabel').textContent = translations[lang].guestbookMessageLabel;
            document.getElementById('guestbookSignerLabel').textContent = translations[lang].guestbookSignerLabel;
            document.getElementById('signGuestbookBtn').querySelector('span').textContent = translations[lang].signGuestbookText;
            document.getElementById('confirmAttendanceText').textContent = translations[lang].confirmAttendanceText;
            document.getElementById('rsvpDeadlineText').textContent = translations[lang].rsvpDeadlineText;
            document.getElementById('rsvpGuestNameLabel').textContent = translations[lang].rsvpGuestNameLabel;
            document.getElementById('numAdultsLabel').textContent = translations[lang].numAdultsLabel;
            document.getElementById('numMinorsLabel').textContent = translations[lang].numMinorsLabel;
            document.getElementById('sendConfirmationText').textContent = translations[lang].sendConfirmationText;
            document.getElementById('declineText').textContent = translations[lang].declineText;


            // Update active language button state
            document.querySelectorAll('.lang-button-main').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`lang${lang.charAt(0).toUpperCase() + lang.slice(1)}Main`).classList.add('active');

            document.body.lang = lang; // Update body lang attribute for CSS/accessibility
            currentLang = lang; // Update current language variable
            localStorage.setItem('weddingLang', lang); // Save preference
        }


        // Función para mostrar mensajes dentro de un div específico (ej. rsvpMessage, songMessage, guestbookMessageDiv)
        function displayMessage(targetDivId, messageKey, isError = false, ...args) {
            const messageDiv = document.getElementById(targetDivId);
            const messageTemplate = translations[currentLang][messageKey];
            // If the message is a function (like rsvpSuccess), call it with args; otherwise, use it directly
            messageDiv.textContent = typeof messageTemplate === 'function' ? messageTemplate(...args) : messageTemplate;

            messageDiv.classList.remove('hidden', 'message-success', 'message-error');
            if (isError) {
                messageDiv.classList.add('message-error');
            } else {
                messageDiv.classList.add('message-success');
            }

            // For success messages, hide after a delay and potentially re-show RSVP button
            if (!isError) {
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                    if (targetDivId === 'rsvpMessage') {
                        document.getElementById('showRsvpFormButton').classList.remove('hidden');
                        document.getElementById('rsvpFormContainer').classList.add('hidden');
                  }
                }, 3000);
            }
        }

        // Inicializa Firebase y configura la autenticación
        const initializeFirebase = async () => {
            try {
                // Ensure firebaseConfig is not empty
                if (!firebaseConfig.apiKey) {
                    console.error("Firebase config is missing API key. Cannot initialize Firebase.");
                    displayMessage('rsvpMessage', "formErrorGeneric", true);
                    displayMessage('songMessage', "formErrorGeneric", true);
                    displayMessage('guestbookMessageDiv', "formErrorGeneric", true);
                    return;
                }
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Firebase Authenticated. User ID:", userId);
                        isAuthReady = true;
                    } else {
                        console.log("No user signed in. Attempting anonymous sign-in.");
                        try {
                            // Using signInAnonymously as per previous code, no initialAuthToken from Canvas
                            await signInAnonymously(auth);
                            isAuthReady = true;
                        } catch (error) {
                            console.error("Firebase Anonymous Sign-in Error:", error);
                            displayMessage('rsvpMessage', "formErrorGeneric", true);
                            displayMessage('songMessage', "formErrorGeneric", true);
                            displayMessage('guestbookMessageDiv', "formErrorGeneric", true);
                            isAuthReady = true; // Ensure isAuthReady is set even on error to avoid infinite loading
                        }
                    }
                });
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                displayMessage('rsvpMessage', "formErrorGeneric", true);
                displayMessage('songMessage', "formErrorGeneric", true);
                displayMessage('guestbookMessageDiv', "formErrorGeneric", true);
            }
        };


        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase(); // Initialize Firebase when DOM is ready
            applyTranslations(currentLang); // Apply initial translations on page load

            // Language button event listeners using event delegation
            document.querySelectorAll('.language-selector-main .lang-button-main').forEach(button => {
                button.addEventListener('click', (e) => {
                    applyTranslations(e.target.dataset.lang);
                });
            });


            const showRsvpFormButton = document.getElementById('showRsvpFormButton');
            const rsvpFormContainer = document.getElementById('rsvpFormContainer');
            const rsvpForm = document.getElementById('rsvpForm');
            const declineButton = document.getElementById('declineButton');

            const songRequestForm = document.getElementById('songRequestForm');
            const guestbookForm = document.getElementById('guestbookForm');
            const giftsLink = document.getElementById('giftsLink'); // Get the Zelle button


            // --- Countdown Logic ---
            const weddingDate = new Date("September 20, 2025 20:00:00").getTime(); // 8:00 P.M.
            const updateCountdown = setInterval(() => {
                const now = new Date().getTime();
                const distance = weddingDate - now;

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById("days").innerHTML = String(days).padStart(2, '0');
                document.getElementById("hours").innerHTML = String(hours).padStart(2, '0');
                document.getElementById("minutes").innerHTML = String(minutes).padStart(2, '0');
                document.getElementById("seconds").innerHTML = String(seconds).padStart(2, '0');

                if (distance < 0) {
                    clearInterval(updateCountdown);
                    document.getElementById("countdown").innerHTML = translations[currentLang].countdownTitle; // Use translated message
                }
            }, 1000);

            // --- Gallery Logic ---
            const galleryInner = document.getElementById('galleryInner');
            const galleryImages = galleryInner.getElementsByTagName('img');
            const galleryPrev = document.getElementById('galleryPrev');
            const galleryNext = document.getElementById('galleryNext');
            const slideshowToggle = document.getElementById('slideshowToggle');
            const slideshowIcon = document.getElementById('slideshowIcon');
            let currentImageIndex = 0;
            let slideshowInterval;
            let isSlideshowPlaying = true; // Default to auto-play

            const startSlideshow = () => {
                if (slideshowInterval) clearInterval(slideshowInterval);
                slideshowInterval = setInterval(() => {
                    currentImageIndex++;
                    updateGallery();
                }, 5000); // Change photo every 5 seconds
                slideshowIcon.className = 'ph ph-pause';
                isSlideshowPlaying = true;
            };

            const pauseSlideshow = () => {
                clearInterval(slideshowInterval);
                slideshowIcon.className = 'ph ph-play';
                isSlideshowPlaying = false;
            };

            const updateGallery = () => {
                if (galleryImages.length === 0) return;
                if (currentImageIndex < 0) {
                    currentImageIndex = galleryImages.length - 1;
                } else if (currentImageIndex >= galleryImages.length) {
                    currentImageIndex = 0;
                }
                const offset = -currentImageIndex * 100;
                galleryInner.style.transform = `translateX(${offset}%)`;
            };

            // Gallery event listeners
            galleryPrev.addEventListener('click', () => {
                pauseSlideshow();
                currentImageIndex--;
                updateGallery();
            });

            galleryNext.addEventListener('click', () => {
                pauseSlideshow();
                currentImageIndex++;
                updateGallery();
            });

            slideshowToggle.addEventListener('click', () => {
                if (isSlideshowPlaying) {
                    pauseSlideshow();
                } else {
                    startSlideshow();
                }
            });

            // Full-screen image modal logic
            const imageModal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const imageModalClose = document.getElementById('imageModalClose');

            Array.from(galleryImages).forEach(img => {
                img.addEventListener('click', (e) => {
                    const largeSrc = e.target.getAttribute('data-src-large') || e.target.src;
                    modalImage.src = largeSrc;
                    imageModal.classList.add('active');
                    pauseSlideshow(); // Pause slideshow when modal opens
                });
            });

            imageModalClose.addEventListener('click', () => {
                imageModal.classList.remove('active');
            });

            imageModal.addEventListener('click', (e) => {
                if (e.target === imageModal) {
                    imageModal.classList.remove('active');
                }
            });

            // Initial gallery load
            if (galleryImages.length > 0) {
                updateGallery();
                startSlideshow(); // Auto-start slideshow on load
            }


            // --- Scroll Animations (Intersection Observer) ---
            const animateOnScrollElements = document.querySelectorAll('.fade-in-up');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate');
                        observer.unobserve(entry.target); // Stop observing once animated
                    }
                });
            }, {
                threshold: 0.1, // 10% of element must be visible
                rootMargin: '0px 0px -50px 0px' // Start animation slightly before reaching bottom of screen
            });

            animateOnScrollElements.forEach(el => {
                observer.observe(el);
            });


            // Show RSVP form button click
            showRsvpFormButton.addEventListener('click', () => {
                showRsvpFormButton.classList.add('hidden');
                rsvpFormContainer.classList.remove('hidden');
                document.getElementById('rsvpMessage').classList.add('hidden'); // Hide any previous messages
            });

            // Handle RSVP confirmation form submission
            rsvpForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAuthReady || !db) {
                    displayMessage('rsvpMessage', "formErrorGeneric", true);
                    return;
                }

                const guestName = document.getElementById('guestName').value.trim();
                const numAdults = parseInt(document.getElementById('numAdults').value, 10);
                const numMinors = parseInt(document.getElementById('numMinors').value, 10);

                if (!guestName) {
                    displayMessage('rsvpMessage', "formErrorName", true);
                    return;
                }
                if (isNaN(numAdults) || numAdults < 0) {
                    displayMessage('rsvpMessage', "formErrorAdults", true);
                    return;
                }
                if (isNaN(numMinors) || numMinors < 0) {
                    displayMessage('rsvpMessage', "formErrorMinors", true);
                    return;
                }

                if (numAdults === 0 && numMinors === 0) {
                    displayMessage('rsvpMessage', "formErrorZeroGuests", true);
                    return;
                }

                try {
                    const rsvpData = {
                        guestName: guestName,
                        adults: numAdults,
                        minors: numMinors,
                        timestamp: new Date(),
                        status: 'confirmed',
                        submittedBy: userId || crypto.randomUUID()
                    };

                    const rsvpsCollectionRef = collection(db, `artifacts/${appId}/public/data/rsvps`);
                    await addDoc(rsvpsCollectionRef, rsvpData);

                    displayMessage('rsvpMessage', 'rsvpSuccess', false, guestName, numAdults, numMinors);
                    rsvpForm.reset();
                }
                catch (error) {
                    console.error("Error submitting RSVP:", error);
                    displayMessage('rsvpMessage', "errorSubmitting", true);
                }
            });

            // Handle 'Cannot attend' button click
            declineButton.addEventListener('click', async () => {
                if (!isAuthReady || !db) {
                    displayMessage('rsvpMessage', "formErrorGeneric", true);
                    return;
                }

                const guestName = document.getElementById('guestName').value.trim();
                if (!guestName) {
                    displayMessage('rsvpMessage', "formErrorName", true);
                    return;
                }

                try {
                    const rsvpData = {
                        guestName: guestName,
                        adults: 0,
                        minors: 0,
                        timestamp: new Date(),
                        status: 'declined',
                        submittedBy: userId || crypto.randomUUID()
                    };

                    const rsvpsCollectionRef = collection(db, `artifacts/${appId}/public/data/rsvps`);
                    await addDoc(rsvpsCollectionRef, rsvpData);

                    displayMessage('rsvpMessage', 'rsvpDeclined', false, guestName);
                    rsvpForm.reset();
                } catch (error) {
                    console.error("Error submitting declination:", error);
                    displayMessage('rsvpMessage', "errorSubmittingDecline", true);
                }
            });

            // Handle song request form submission
            songRequestForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAuthReady || !db) {
                    displayMessage('songMessage', "formErrorGeneric", true);
                    return;
                }

                const songName = document.getElementById('songName').value.trim();
                const songArtist = document.getElementById('songArtist').value.trim();
                const songExplanation = document.getElementById('songExplanation').value.trim();
                const requesterNameSong = document.getElementById('requesterNameSong').value.trim();

                if (!songName) {
                    displayMessage('songMessage', "formErrorSongTitle", true);
                    return;
                }

                try {
                    const songRequestData = {
                        songName: songName,
                        songArtist: songArtist || 'Desconocido',
                        explanation: songExplanation || '',
                        requesterName: requesterNameSong || 'Anónimo',
                        timestamp: new Date(),
                        submittedBy: userId || crypto.randomUUID()
                    };

                    const songRequestsCollectionRef = collection(db, `artifacts/${appId}/public/data/songRequests`);
                    await addDoc(songRequestsCollectionRef, songRequestData);

                    displayMessage('songMessage', 'songSuccess', false, songName, songArtist);
                    songRequestForm.reset();
                } catch (error) {
                    console.error("Error submitting song request:", error);
                    displayMessage('songMessage', "errorSubmittingSong", true);
                }
            });

            // Handle guestbook form submission
            guestbookForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAuthReady || !db) {
                    displayMessage('guestbookMessageDiv', "formErrorGeneric", true);
                    return;
                }

                const guestbookMessage = document.getElementById('guestbookMessage').value.trim();
                const guestbookSigner = document.getElementById('guestbookSigner').value.trim();

                if (!guestbookMessage) {
                    displayMessage('guestbookMessageDiv', "formErrorMessage", true);
                    return;
                }
                if (!guestbookSigner) {
                    displayMessage('guestbookMessageDiv', "formErrorSigner", true);
                    return;
                }

                try {
                    const guestbookEntryData = {
                        message: guestbookMessage,
                        signer: guestbookSigner,
                        timestamp: new Date(),
                        submittedBy: userId || crypto.randomUUID()
                    };

                    const guestbookCollectionRef = collection(db, `artifacts/${appId}/public/data/guestbookEntries`);
                    await addDoc(guestbookCollectionRef, guestbookEntryData);

                    displayMessage('guestbookMessageDiv', 'guestbookSuccess', false, guestbookSigner);
                    guestbookForm.reset();
                } catch (error) {
                    console.error("Error submitting guestbook entry:", error);
                    displayMessage('guestbookMessageDiv', "errorSubmittingGuestbook", true);
                }
            });

            // Logic to add event to calendar
            const addToCalendarBtn = document.getElementById('addToCalendarBtn');
            if (addToCalendarBtn) {
                addToCalendarBtn.addEventListener('click', (e) => {
                    e.preventDefault();

                    const eventTitle = translations[currentLang].agendaEvent;
                    const eventLocation = translations[currentLang].addressText;
                    const eventDescription = translations[currentLang].invitationText;

                    const startDate = new Date("September 20, 2025 20:00:00");
                    const endDate = new Date(startDate.getTime() + (4 * 60 * 60 * 1000));

                    const formatDateTime = (date) => {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        const hours = String(date.getHours()).padStart(2, '0');
                        const minutes = String(date.getMinutes()).padStart(2, '0');
                        const seconds = String(date.getSeconds()).padStart(2, '0');
                        return `${year}${month}${day}T${hours}${minutes}${seconds}`;
                    };

                    const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventTitle)}&dates=${formatDateTime(startDate)}/${formatDateTime(endDate)}&details=${encodeURIComponent(eventDescription)}&location=${encodeURIComponent(eventLocation)}&sf=true&output=xml`;

                    window.open(googleCalendarUrl, '_blank');
                });
            }

            // Logic to open WhatsApp or SMS
            function openWhatsAppOrSMS(phoneNumber, isWhatsAppPreferred = true, messageKey) {
                let message = translations[currentLang][messageKey]; // Use messageKey directly from translations

                let cleanedNumber = phoneNumber.replace(/[^0-9]/g, '');
                if (cleanedNumber.length === 10) {
                    cleanedNumber = '1' + cleanedNumber;
                }

                const whatsappUrl = `https://wa.me/${cleanedNumber}?text=${encodeURIComponent(message)}`;
                const smsUrl = `sms:${phoneNumber}?body=${encodeURIComponent(message)}`;

                if (isWhatsAppPreferred) {
                    const newWindow = window.open(whatsappUrl, '_blank');
                    // Fallback to SMS if WhatsApp doesn't open
                    setTimeout(() => {
                        try {
                            if (newWindow && newWindow.closed || !newWindow) {
                                window.location.href = smsUrl;
                            }
                        } catch (e) {
                            // Catch potential security errors if newWindow.closed is accessed too soon
                            window.location.href = smsUrl;
                        }
                    }, 1000); // Give 1 second for WhatsApp to try and open
                } else {
                    window.location.href = smsUrl;
                }
            }

            document.getElementById('karenContact').addEventListener('click', (e) => {
                e.preventDefault();
                openWhatsAppOrSMS('7862855066', true, "karenWhatsappMessage");
            });

            document.getElementById('fabianContact').addEventListener('click', (e) => {
                e.preventDefault();
                openWhatsAppOrSMS('9549552895', true, "fabianWhatsappMessage");
            });

            // Zelle button click to copy number
            const giftsLinkElement = document.getElementById('giftsLink'); // Renamed to avoid conflict
            giftsLinkElement.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent default link behavior
                const zelleNumber = '9549552895'; // The Zelle number to copy

                // Use the new displayMessage for Zelle confirmation/error
                navigator.clipboard.writeText(zelleNumber).then(() => {
                    displayMessage('giftsNoteText', 'zelleCopied', false); // Show success under giftsNoteText
                }).catch(err => {
                    console.error('Failed to copy Zelle number:', err);
                    displayMessage('giftsNoteText', 'copyError', true); // Show error under giftsNoteText
                });
            });
        });
    </script>
</body>
</html>
